{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://bcm.foodaroo.com/schemas/commands/DeclarerSinistre.v1.json",
  "title": "DeclarerSinistre Command",
  "description": "Command to declare a new insurance claim. Triggers generation of identifiantSinistre and emission of SinistreDéclaré event.",
  "type": "object",
  "required": [
    "identifiantContrat",
    "typeSinistre",
    "dateSurvenance"
  ],
  "properties": {
    "identifiantContrat": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Reference to the insurance contract associated with this claim (REQUIRED)",
      "example": "CONTRAT-2026-001"
    },
    "typeSinistre": {
      "type": "string",
      "minLength": 1,
      "maxLength": 50,
      "description": "Type of claim (REQUIRED, validated against reference database). Examples: ACCIDENT_CORPOREL, DEGATS_MATERIELS, RESPONSABILITE_CIVILE",
      "example": "ACCIDENT_CORPOREL"
    },
    "dateSurvenance": {
      "type": "string",
      "format": "date",
      "description": "Date when the insured event occurred (REQUIRED, ISO 8601 date only, must be <= today)",
      "example": "2026-01-20"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "identifiantContrat": "CONTRAT-2026-001",
      "typeSinistre": "ACCIDENT_CORPOREL",
      "dateSurvenance": "2026-01-20"
    },
    {
      "identifiantContrat": "CONTRAT-2026-042",
      "typeSinistre": "DEGATS_MATERIELS",
      "dateSurvenance": "2026-01-15"
    }
  ],
  "x-validation-rules": {
    "identifiantContrat": {
      "required": true,
      "notEmpty": true,
      "errorMessage": "IdentifiantContrat obligatoire"
    },
    "typeSinistre": {
      "required": true,
      "notEmpty": true,
      "existsInDatabase": "typeSinistreReference",
      "errorMessage": "TypeSinistre obligatoire et doit exister dans la base de données de référence"
    },
    "dateSurvenance": {
      "required": true,
      "lessThanOrEqualToToday": true,
      "errorMessage": "DateSurvenance ne peut pas être dans le futur"
    }
  },
  "x-auto-generated-fields": {
    "identifiantSinistre": {
      "description": "Auto-generated by IIdentifiantSinistreGenerator in format SIN-YYYY-NNNNNN",
      "example": "SIN-2026-000001",
      "strategy": "MongoDB atomic sequence with format SIN-{YEAR}-{SEQUENCE}"
    },
    "dateDeclaration": {
      "description": "Auto-set to server timestamp (DateTime.UtcNow) when command is processed",
      "example": "2026-01-27T14:30:00.000Z",
      "strategy": "System clock at command handler execution time"
    }
  },
  "x-response": {
    "success": {
      "statusCode": 201,
      "description": "Claim successfully declared",
      "schema": {
        "type": "object",
        "properties": {
          "identifiantSinistre": {
            "type": "string",
            "pattern": "^SIN-\\d{4}-\\d{6}$",
            "example": "SIN-2026-000001"
          },
          "dateDeclaration": {
            "type": "string",
            "format": "date-time",
            "example": "2026-01-27T14:30:00.000Z"
          }
        }
      }
    },
    "errors": [
      {
        "statusCode": 400,
        "errorCode": "VALIDATION_FAILED",
        "description": "Command validation failed (missing required fields, invalid format, future dateSurvenance)"
      },
      {
        "statusCode": 404,
        "errorCode": "TYPE_SINISTRE_INVALIDE",
        "description": "TypeSinistre does not exist in reference database"
      },
      {
        "statusCode": 503,
        "errorCode": "VALIDATION_SERVICE_UNAVAILABLE",
        "description": "TypeSinistre validation service temporarily unavailable (circuit breaker open)"
      }
    ]
  }
}
